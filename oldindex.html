<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/colreorder/1.5.2/css/colReorder.dataTables.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- section start -->
    <section>
        <div class="container">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <a class="nav-item  nav-link " id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="false">Add</a>
                    <a class="nav-item nav-link " id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">View</a>

                </div>
            </nav>
            <div id="msg"></div>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                    <div class="container">
                        <!-- add user start -->

                        <h1 class="text-center  p-8">Add Customer</h1>
                        <hr>
                        <form id="adduser" method="POST" lass="needs-validation" novalidate>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputName">First Name</label>
                                    <input type="text" class="form-control" name="firstname" id="inputName" placeholder="ex. suru">
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="inputName">Last Name</label>
                                    <input type="text" class="form-control" name="lastname" id="inputName2" placeholder="ex. pinninti">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputemail">Email</label>
                                    <input type="email" class="form-control" name="email" id="inputemail" placeholder="ex. test@gmail.com">
                                    <div class="err"></div>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="inputAddress2">Phone</label>
                                    <input type="text" class="form-control" name="phone" id="inputPhone" placeholder="ex. 96543210">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputState">country</label>
                                    <select id="inputcountry" name="country" class="form-control country">
                                  <option selected>Choose...</option>
                                  <option value="india">India</option>
                                  <option value="usa">Usa</option>
                                  <option value="uk">Uk</option>
                                </select>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="inputState">State</label>
                                    <div id="state"></div>
                                    <select id="State" class="form-control state">
                                      <option selected>Choose...</option>
                                </select>


                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputZip">Pincode</label>
                                    <input type="text" class="form-control" name="pincode" id="inputZip" placeholder="ex. 534401">
                                </div>
                                <div class="form-group col-md-6">

                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="inputGroupFile03">
                                        <label class="custom-file-label" for="inputGroupFile03">Choose file</label>
                                    </div>
                                </div>
                                <div id="preview"></div>
                            </div>
                    </div>
                    <button type="submit" id="submit" class="btn btn-primary">Sign in</button>


                    </form>

                </div>
                <!-- add user end -->
                <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                    <div id="deletemsg"></div>
                    <!-- list of users satrt  -->
                    <h1>All customers</h1>
                    <table id="example" class="display" style="width:100%">
                        <thead>
                            <tr>
                                <th>id</th>
                                <th>firstname</th>
                                <th>lastname</th>
                                <th>email</th>
                                <th>phone.</th>
                                <th>country</th>
                                <th>state</th>
                                <th>pincode</th>
                                <th>edit</th>
                                <th>delete</th>

                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th>id</th>
                                <th>firstname</th>
                                <th>lastname</th>
                                <th>email</th>
                                <th>phone.</th>
                                <th>country</th>
                                <th>state</th>
                                <th>pincode</th>
                                <th>edit</th>
                                <th>delete</th>

                            </tr>
                        </tfoot>
                    </table>
                    <!-- list of users end -->
                    <div id="rem" style="display: none;">
                        <!--edit user  -->
                        <h1 class="text-center  p-8">Edit Customer</h1>
                        <div id="updatemsg"></div>
                        <hr>
                        <form id="updateuser" method="POST" lass="needs-validation" novalidate>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputName">First Name</label>
                                    <input type="text" class="form-control" name="updatefirstname" id="updatefirstname" placeholder="ex. suru">
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="inputName">Last Name</label>
                                    <input type="text" class="form-control" name="updatelastname" id="updatelastname" placeholder="ex. pinninti">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputemail">Email</label>
                                    <input type="email" class="form-control" name="updateemail" id="updateemail" placeholder="ex. test@gmail.com">
                                    <div class="err"></div>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="inputAddress2">Phone</label>
                                    <input type="text" class="form-control" name="number" id="number" placeholder="ex. 96543210">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputState">country</label>
                                    <input type="text" class="form-control" name="updatecountry" id="updatecountry" placeholder="ex. india">

                                </div>
                                <div class="form-group col-md-6">
                                    <label for="inputState">State</label>
                                    <input type="text" class="form-control" name="updatestate" id="updatestate" placeholder="ex. india">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="inputZip">Pincode</label>
                                    <input type="text" class="form-control" name="updatepincode" id="updatepincode" placeholder="ex. 534401">
                                </div>
                                <div class="form-group col-md-6">

                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="updateimg">
                                        <label class="custom-file-label" for="inputGroupFile03">Choose file</label>
                                    </div>
                                </div>

                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <button type="submit" id="submit" class="btn btn-primary">update</button>
                                </div>
                                <div class="form-group col-md-6">
                                    <!-- <label for="inputAddress2">Phone</label> -->
                                    <img src="" id="img" width="100%" height="50%" alt="" srcset="">
                                </div>
                            </div>
                    </div>
                    <input type="hidden" id="userid" name="userid">


                    </form>
                </div>
            </div>
            <!-- edit user end -->
        </div>

        </div>



    </section>

    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js" charset="utf8" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/colreorder/1.5.2/js/dataTables.colReorder.min.js"></script>

    <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>


    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.9.0/jquery.validate.min.js"></script>
    <script>
        /// sending data to datatable ///

        $(document).ready(function() {
            let table = $('#example').DataTable({

                "processing": false,
                ajax: "data.php",

                "columns": [{

                    data: 'sno'
                }, {

                    data: 'firstname'
                }, {
                    data: 'lastname'
                }, {
                    data: 'email'
                }, {
                    data: 'phone'
                }, {
                    data: 'country'
                }, {
                    data: 'state'
                }, {
                    data: 'pincode'
                }, {
                    data: 'edit'
                }, {
                    data: 'delete'
                }],
                colReorder: {
                    realtime: false
                },
                "order": [
                    [0, 'asc'],
                    [1, 'asc']
                ],
                responsive: true

            });


            /// select state according to country  ///
            $(".country").change(function() {
                let selectedcountry = $(".country option:selected").val();

                $.ajax({
                    type: "POST",
                    url: "controler.php",
                    data: {
                        "country": selectedcountry,
                        "type": "select"
                    },
                    success: function(response) {

                        $("#state").html(response)
                        $(".state").remove()
                    }
                });


            });
            /// uplide image ///
            let img = "";

            $('#inputGroupFile03').on('change', function() {

                const file_data = $(this).prop('files')[0];
                const form_data = new FormData();
                const ext = $(this).val().split('.').pop().toLowerCase();
                if ($.inArray(ext, ['png', 'jpg', 'jpeg']) == -1) {
                    alert("only jpg and png images allowed");
                    return;
                }
                const picsize = (file_data.size);
                console.log(picsize); /*in byte*/
                if (picsize > 2097152) /* 2mb*/ {
                    alert("Image allowd less than 2 mb")
                    return;
                }
                form_data.append('file', file_data);


                $.ajax({
                    url: 'controler.php',
                    /*point to server-side PHP script */
                    dataType: 'text',
                    /* what to expect back from the PHP script, if anything*/
                    cache: false,
                    contentType: false,
                    processData: false,
                    data: form_data,
                    type: 'post',

                    success: function(res) {




                        img = res;

                        $("#msg").html('<div class="alert alert-success alert-dismissible fade show" role="alert"> <strong>Image uploaded successfuly</strong> <button type="button" class="close" data-dismiss="alert" aria-label="Close">    <span aria-hidden="true">&times;</span></button></div>');




                    }
                });
            });

            /// add user  ///            

            $("#adduser").validate({
                rules: {
                    firstname: {
                        minlength: 2,
                        required: true
                    },
                    lastname: {
                        minlength: 2,
                        required: true
                    },
                    email: {
                        required: true,
                        email: true
                    },
                    phone: {
                        minlength: 2,
                        required: true,

                    },

                    pincode: {
                        required: true
                    },
                    state: {
                        required: true

                    },
                    country: {
                        required: true
                    }



                },
                highlight: function(element) {

                    $(element).css("color:red");
                },
                submitHandler: function(form) {

                    event.preventDefault();


                    let data = {
                        "firstname": $("input[name=firstname]").val(),
                        "lastname": $("input[name=lastname]").val(),
                        "email": $("input[name=email]").val(),
                        "phone": $("input[name=phone]").val(),
                        "country": $(".country").val(),
                        "state": $(".state-selected").val(),
                        "pincode": $("input[name=pincode]").val(),
                        "img": img,

                    }


                    $.ajax({
                        url: "controler.php",
                        type: "POST",
                        data: data,
                        success: function(res) {



                            $("#msg").html(res);

                            $("#adduser").trigger("reset");

                        },
                    });
                    return false;
                }
            });

            /// update image ///

            $('#updateimg').on('change', function() {

                const file_data = $(this).prop('files')[0];
                const form_data = new FormData();
                const ext = $(this).val().split('.').pop().toLowerCase();
                if ($.inArray(ext, ['png', 'jpg', 'jpeg']) == -1) {
                    alert("only jpg and png images allowed");
                    return;
                }
                const picsize = (file_data.size);
                console.log(picsize);
                if (picsize > 2097152) {
                    alert("Image allowd less than 2 mb")
                    return;
                }
                form_data.append('file', file_data);
                $.ajax({
                    url: 'controler.php',

                    dataType: 'text',

                    cache: false,
                    contentType: false,
                    processData: false,
                    data: form_data,
                    type: 'post',

                    success: function(res) {
                        img = res;

                        $("#updatemsg").html('<div class="alert alert-success alert-dismissible fade show" role="alert"> <strong>Image uploaded successfuly</strong> <button type="button" class="close" data-dismiss="alert" aria-label="Close">    <span aria-hidden="true">&times;</span></button></div>');
                    }
                });
            });


            /// update user ///

            $("#updateuser").validate({
                rules: {
                    updatefirstname: {
                        minlength: 2,
                        required: true
                    },
                    updatelastname: {
                        minlength: 2,
                        required: true
                    },
                    updateemail: {
                        required: true,
                        email: true
                    },
                    updatenumber: {
                        minlength: 2,
                        required: true,

                    },

                    updatepincode: {
                        required: true
                    },
                    updatestate: {
                        required: true

                    },
                    updatecountry: {
                        required: true
                    }

                },
                highlight: function(element) {

                    $(element).css("color:red");
                },
                submitHandler: function(form) {




                    event.preventDefault();


                    let data = {
                        "updatefirstname": $("input[name=updatefirstname]").val(),
                        "updatelastname": $("input[name=updatelastname]").val(),
                        "updateemail": $("input[name=updateemail]").val(),
                        "updatephone": $("input[name=number]").val(),
                        "updatecountry": $("input[name=updatecountry]").val(),
                        "updatestate": $("input[name=updatestate]").val(),
                        "updatepincode": $("input[name=updatepincode]").val(),
                        "updateimg": img,
                        "updateuserid": $("input[name=userid]").val(),

                    }


                    $.ajax({
                        url: "controler.php",
                        type: "POST",
                        data: data,
                        success: function(res) {



                            $("#updatemsg").html(res);

                            $("#updateuser").trigger("reset");

                        },
                    });
                    return false;
                }

            });




            setInterval(function() {
                table.ajax.reload(null, false);
            }, 1000);


        })



        /// user data for edit ///
        function edit(id) {
            $("#rem").removeAttr("style");

            $.ajax({
                type: "POST",
                url: "controler.php",
                data: {
                    "id": id
                },
                success: function(data) {

                    let obj = JSON.parse(data);

                    obj.forEach(element => {

                        $("#updatefirstname").val(element.firstname);
                        $("#updatelastname").val(element.lastname);
                        $("#updateemail").val(element.email);
                        $("#number").val(element.phone);
                        $("#updatecountry").val(element.country);
                        $("#updatestate").val(element.state);
                        $("#updatepincode").val(element.pincode);
                        $('#img').attr('src', "uploads/" + element.img);
                        $("#userid").val(element.userid);


                    });


                }
            });




        }

        /// delete user data ///      

        function deleteuser(id) {

            if (confirm("Are you sure?")) {
                $.ajax({
                    type: "POST",
                    url: "controler.php",
                    data: {
                        "userid": id,
                        "status": "delete"
                    },

                    success: function(response) {
                        $("#deletemsg").html(response);

                    }
                });

            }


        }
    </script>
</body>

</html>